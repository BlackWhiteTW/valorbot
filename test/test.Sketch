#include <Wire.h>
#include <LiquidCrystal_I2C.h>
#include <Mouse.h>

LiquidCrystal_I2C lcd(0x27, 20, 4);  // 設定 LCD 地址和尺寸

int screenWidth = 1920;  // 預設螢幕寬度
int screenHeight = 1080; // 預設螢幕高度

void setup() {
  Serial.begin(9600);
  Mouse.begin();
  lcd.begin();
  lcd.backlight();
  lcd.setCursor(0, 0);
  lcd.print("Waiting for data");
}

void loop() {
  if (Serial.available() > 0) {
    String data = Serial.readStringUntil('\n');
    if (data.startsWith("SCREEN_SIZE")) {
      int firstComma = data.indexOf(',');
      int secondComma = data.indexOf(',', firstComma + 1);
      screenWidth = data.substring(firstComma + 1, secondComma).toInt();
      screenHeight = data.substring(secondComma + 1).toInt();
      lcd.clear();
      lcd.setCursor(0, 0);
      lcd.print("Screen Size:");
      lcd.setCursor(0, 1);
      lcd.print(screenWidth);
      lcd.print("x");
      lcd.print(screenHeight);
    } else {
      int commaIndex = data.indexOf(',');
      if (commaIndex > 0) {
        int x = data.substring(0, commaIndex).toInt();
        int y = data.substring(commaIndex + 1).toInt();
        moveMouse(x, y);
        lcd.clear();
        lcd.setCursor(0, 0);
        lcd.print("Mouse Pos:");
        lcd.setCursor(0, 1);
        lcd.print("X: ");
        lcd.print(x);
        lcd.setCursor(0, 2);
        lcd.print("Y: ");
        lcd.print(y);
      }
    }
  }
}

void moveMouse(int x, int y) {
  // 將螢幕座標轉換為滑鼠移動量
  int moveX = map(x, 0, screenWidth, -960, 960); // 根據螢幕解析度調整
  int moveY = map(y, 0, screenHeight, -540, 540); // 根據螢幕解析度調整
  Mouse.move(moveX, moveY);
}